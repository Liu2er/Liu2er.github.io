
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>iOS Push | Liu2er的技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Liu2er">
    

    <meta name="keywords" content="iOS, Push">
    <meta name="description" content="iOS Push 门道

iOS 推送证书设置指南

iOS推送的那些事

一步一步教你做 iOS 推送

一步一步实现 iOS 应用 Push 功能

APNs Provider API

Apple Developer 证书配置中心

Mac 上的消息推送测试工具 PushMeBaby

使用 PushMeBaby 测试 APP 的远程推送功能

iOS 消息推送服务器的 Java 实现">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS Push">
<meta property="og:url" content="http://liu2er.com/2016/09/08/2016_09_08_iOSPush/index.html">
<meta property="og:site_name" content="Liu2er的技术博客">
<meta property="og:description" content="iOS Push 门道

iOS 推送证书设置指南

iOS推送的那些事

一步一步教你做 iOS 推送

一步一步实现 iOS 应用 Push 功能

APNs Provider API

Apple Developer 证书配置中心

Mac 上的消息推送测试工具 PushMeBaby

使用 PushMeBaby 测试 APP 的远程推送功能

iOS 消息推送服务器的 Java 实现">
<meta property="og:image" content="http://liu2er.com/images/2016_09_08_iOSPush-PushSequence1.jpg">
<meta property="og:image" content="http://liu2er.com/images/2016_09_08_iOSPush-PushSequence2.png">
<meta property="og:image" content="http://liu2er.com/images/2016_09_08_iOSPush-PushSequence3.png">
<meta property="og:updated_time" content="2016-09-08T09:18:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS Push">
<meta name="twitter:description" content="iOS Push 门道

iOS 推送证书设置指南

iOS推送的那些事

一步一步教你做 iOS 推送

一步一步实现 iOS 应用 Push 功能

APNs Provider API

Apple Developer 证书配置中心

Mac 上的消息推送测试工具 PushMeBaby

使用 PushMeBaby 测试 APP 的远程推送功能

iOS 消息推送服务器的 Java 实现">
<meta name="twitter:image" content="http://liu2er.com/images/2016_09_08_iOSPush-PushSequence1.jpg">

    
    <link rel="alternative" href="/atom.xml" title="Liu2er的技术博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Liu2er的技术博客">Liu2er的技术博客</a></h1>
				<h2 class="blog-motto">世界那么大，我早晚要去看</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:liu2er.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/08/2016_09_08_iOSPush/" title="iOS Push" itemprop="url">iOS Push</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Liu2er" target="_blank" itemprop="author">Liu2er</a>
		
  <p class="article-time">
    <time datetime="2016-09-08T08:29:04.000Z" itemprop="datePublished"> 發表於 2016-09-08</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			
		
		</div>
		
		<ul>
<li><p><a href="http://mrpeak.cn/ios/2016/01/06/push" target="_blank" rel="external">iOS Push 门道</a></p>
</li>
<li><p><a href="https://leancloud.cn/docs/ios_push_cert.html" target="_blank" rel="external">iOS 推送证书设置指南</a></p>
</li>
<li><p><a href="http://superdanny.link/2016/02/02/iOS-Apple-Push-Notification-Service/" target="_blank" rel="external">iOS推送的那些事</a></p>
</li>
<li><p><a href="http://blog.csdn.net/showhilllee/article/details/8631734" target="_blank" rel="external">一步一步教你做 iOS 推送</a></p>
</li>
<li><p><a href="http://tanqisen.github.io/blog/2013/02/27/ios-push-apns/" target="_blank" rel="external">一步一步实现 iOS 应用 Push 功能</a></p>
</li>
<li><p><a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/APNsProviderAPI.html#//apple_ref/doc/uid/TP40008194-CH101-SW1" target="_blank" rel="external">APNs Provider API</a></p>
</li>
<li><p><a href="https://developer.apple.com/account/" target="_blank" rel="external">Apple Developer 证书配置中心</a></p>
</li>
<li><p><a href="http://www.cocoachina.com/bbs/read.php?tid=195467" target="_blank" rel="external">Mac 上的消息推送测试工具 PushMeBaby</a></p>
</li>
<li><p><a href="http://io.diveinedu.com/2015/01/24/%E4%BD%BF%E7%94%A8PushMeBaby%E6%B5%8B%E8%AF%95APP%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A8%E9%80%81%E5%8A%9F%E8%83%BD.html" target="_blank" rel="external">使用 PushMeBaby 测试 APP 的远程推送功能</a></p>
</li>
<li><p><a href="http://www.programgo.com/article/68982800051/;jsessionid=4DE852D70D7623B679B78CBD16EA45CB" target="_blank" rel="external">iOS 消息推送服务器的 Java 实现</a></p>
</li>
<li><p><a href="http://blog.handy.wang/blog/2013/12/19/mac-osxia-da-jian-apnstui-song-fu-wu-qi/" target="_blank" rel="external">iOS 消息推送服务器的 PHP 实现</a></p>
</li>
<li><p><a href="http://blog.csdn.net/tonny_guan/article/details/8963262" target="_blank" rel="external">推送通知 iOS 客户端编写实现及推送服务器端编写</a></p>
</li>
<li><p><a href="http://docs.jiguang.cn/jpush/client/iOS/ios_guide_new/" target="_blank" rel="external">JPush iOS SDK 集成指南</a></p>
</li>
</ul>
<hr>
<p>iOS Push 流程涉及到四个角色：<code>Device</code>、<code>APP</code>、<code>Provider</code>、<code>APNs</code></p>
<p><strong>Device：</strong>iOS设备，用来接收 APNs 下发下来的消息</p>
<p><strong>Client App：</strong>iOS 设备上的应用程序，用来接收 APNs 下发的消息到指定的一个客户端 app (消息的最终响应者)</p>
<p><strong>Provider：</strong>我们自己搭建的 APP Push服务器</p>
<p><strong>APNs：</strong>苹果的服务器（Apple Push Notification Service）</p>
<p>deviceToken 唯一的标识一个用户。在使用推送功能的时候，需要在开发者中心创建支持Push Notification的证书，并且将证书和私钥用于应用后台服务器与APNs之间通信。</p>
<p><img src="/images/2016_09_08_iOSPush-PushSequence1.jpg"></p>
<blockquote>
<p>上图可以分为三个阶段：</p>
<ul>
<li><p>第一阶段：应用程序把要发送的消息、目的iPhone的标识打包，发给APNS。 </p>
</li>
<li><p>第二阶段：APNS在自身的已注册Push服务的iPhone列表中，查找有相应标识的iPhone，并把消息发送到iPhone。 </p>
</li>
<li><p>第三阶段：iPhone把发来的消息传递给相应的应用程序，并且按照设定弹出Push通知。</p>
</li>
</ul>
</blockquote>
<hr>
<p><img src="/images/2016_09_08_iOSPush-PushSequence2.png" width="80%"></p>
<blockquote>
<p>Push 的关键流程：</p>
<ol>
<li><p>创建Push SSL Certification(推送证书)</p>
</li>
<li><p>iOS客户端注册Push功能并获得DeviceToken</p>
</li>
<li><p>使用Provider向APNS发送Push消息</p>
</li>
<li><p>iOS客户端接收处理由APNS发来的消息</p>
</li>
</ol>
</blockquote>
<hr>
<p><img src="/images/2016_09_08_iOSPush-PushSequence3.png" width="60%"></p>
<blockquote>
<p>Push 的工作流程：</p>
<ol>
<li><p>APP向系统注册推送服务。</p>
</li>
<li><p>设备从APNs请求deviceToken。</p>
</li>
<li><p>通过代理方法将deviceToken返回给APP。</p>
</li>
<li><p>APP将deviceToken发送给应用后台服务器（Provider）。</p>
</li>
<li><p>应用后台服务器保存deviceToken，然后在需要推送通知的时候，给APNs发送信息，使用deviceToken标识所要送达的客户端。</p>
</li>
<li><p>APNs将后台服务器发过来的数据推送到设备。</p>
</li>
<li><p>设备将消息分发给应用程序。</p>
</li>
</ol>
</blockquote>
<hr>
<blockquote>
<p>整体流程分为五步：</p>
<ol>
<li><p>Device –&gt; 连接 –&gt; APNs：获取 DeviceToke</p>
</li>
<li><p>Device –&gt; 连接 –&gt; Provider：提供 DeviceToke</p>
</li>
<li><p>Provider 检测需要 push 的消息生成 Notification 信息</p>
</li>
<li><p>Provider 把要 push 的消息推送到 APNs</p>
</li>
<li><p>APNs 把该消息推送到手机</p>
</li>
</ol>
</blockquote>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Push/">Push</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://liu2er.com/2016/09/08/2016_09_08_iOSPush/" data-title="iOS Push | Liu2er的技术博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2016/08/29/2016_08_29_UINavigationControllerNote/"  title="UINavigationController + UINavigationBar + UIWebView 范例">
 <strong>下一篇：</strong><br/> 
 <span>UINavigationController + UINavigationBar + UIWebView 范例
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/09/08/2016_09_08_iOSPush/" data-title="iOS Push" data-url="http://liu2er.com/2016/09/08/2016_09_08_iOSPush/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/Blog/" title="Blog">Blog<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Git/" title="Git">Git<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Objective-C/" title="Objective-C">Objective-C<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>4</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/RAC/" title="RAC">RAC<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Git/" title="Git">Git<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Octopress/" title="Octopress">Octopress<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/NSString/" title="NSString">NSString<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/UINavigationController/" title="UINavigationController">UINavigationController<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Push/" title="Push">Push<sup>1</sup></a></li>
			
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Liu2er">Liu2er</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"liu2er"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 









<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
